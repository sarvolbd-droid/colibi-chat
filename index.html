<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Colibi Chat</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #f0f2f5;
    display: flex;
    justify-content: center;
    align-items: flex-start;
    min-height: 100vh;
    padding: 20px;
  }
  #chat {
    width: 100%;
    max-width: 600px;
    background: white;
    border-radius: 10px;
    box-shadow: 0 0 10px rgba(0,0,0,0.1);
    display: flex;
    flex-direction: column;
    padding: 15px;
  }
  h2 { text-align: center; }
  #messages {
    flex: 1;
    height: 400px;
    overflow-y: auto;
    border: 1px solid #ccc;
    border-radius: 8px;
    padding: 10px;
    margin-bottom: 10px;
    background: #f9f9f9;
  }
  .msg {
    margin: 5px 0;
    padding: 8px 12px;
    border-radius: 15px;
    max-width: 70%;
    word-wrap: break-word;
  }
  .me { background: #d1f7c4; align-self: flex-end; }
  .other { background: #eee; align-self: flex-start; }
  #input-area { display: flex; gap: 10px; }
  #input-area input { flex: 1; padding: 8px; border-radius: 8px; border: 1px solid #ccc; }
  #input-area button { padding: 8px 15px; border: none; background: #4CAF50; color: white; border-radius: 8px; cursor: pointer; }
  #input-area button:hover { background: #45a049; }
</style>
</head>
<body>

<div id="chat">
  <h2>ðŸ’¬ Colibi Chat</h2>
  <div id="messages"></div>
  <div id="input-area">
    <input type="text" id="username" placeholder="Pseudo">
    <input type="text" id="message" placeholder="Message...">
    <button onclick="sendMessage()">Envoyer</button>
  </div>
</div>

<!-- Firebase -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getFirestore, collection, addDoc, query, orderBy, onSnapshot } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

// âš¡ Ta config Firebase
const firebaseConfig = {
  apiKey: "AIzaSyAn9pP4NR26KnG1by_5X_LTI4_aHXfXIuc",
  authDomain: "colibichat.firebaseapp.com",
  projectId: "colibichat",
  storageBucket: "colibichat.firebasestorage.app",
  messagingSenderId: "561322381627",
  appId: "1:561322381627:web:c2a1e0fc7f25f5d7b3e71e",
  measurementId: "G-CDLZDY69D8"
};

// Initialisation Firebase
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const messagesDiv = document.getElementById("messages");

async function sendMessage() {
  const user = document.getElementById("username").value.trim();
  const text = document.getElementById("message").value.trim();
  if(user && text) {
    await addDoc(collection(db, "messages"), {
      user: user,
      text: text,
      time: Date.now()
    });
    document.getElementById("message").value = "";
  }
}

// Ã‰coute en temps rÃ©el
const q = query(collection(db, "messages"), orderBy("time"));
onSnapshot(q, (snapshot) => {
  messagesDiv.innerHTML = "";
  snapshot.forEach(doc => {
    const msg = doc.data();
    const div = document.createElement("div");
    div.className = "msg " + (msg.user === document.getElementById("username").value ? "me" : "other");
    div.innerText = msg.user + ": " + msg.text;
    messagesDiv.appendChild(div);
  });
  messagesDiv.scrollTop = messagesDiv.scrollHeight;
});

window.sendMessage = sendMessage;
</script>

</body>
</html>
